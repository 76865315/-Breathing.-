<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Breathe</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --purple: #8b5cf6;
      --green: #22c55e;
      --orange: #f97316;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-900: #111827;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
      min-height: 100vh;
      color: white;
      -webkit-app-region: drag;
      user-select: none;
    }

    button, input, .no-drag {
      -webkit-app-region: no-drag;
    }

    .container {
      padding: 60px 24px 24px;
      max-width: 100%;
      min-height: 100vh;
    }

    /* Navigation */
    .nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 12px 16px;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid var(--gray-200);
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--gray-400);
      background: none;
      border: none;
      font-size: 11px;
      font-weight: 500;
    }

    .nav-item.active {
      color: var(--primary);
    }

    .nav-item:hover {
      background: var(--gray-50);
    }

    .nav-item svg {
      width: 24px;
      height: 24px;
      margin-bottom: 4px;
    }

    /* Screens */
    .screen {
      display: none;
      padding-bottom: 100px;
    }

    .screen.active {
      display: block;
    }

    /* Home Screen */
    .greeting {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .subtitle {
      opacity: 0.8;
      margin-bottom: 24px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: rgba(255,255,255,0.15);
      border-radius: 16px;
      padding: 16px;
      text-align: center;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
    }

    .stat-label {
      font-size: 11px;
      opacity: 0.8;
    }

    /* Quick Start Card */
    .quick-start {
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .quick-start-label {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .quick-start-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .quick-start-desc {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 16px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 24px;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }

    .btn-primary {
      background: white;
      color: var(--primary);
    }

    .btn-primary:hover {
      transform: scale(1.02);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.2);
      color: white;
    }

    .btn-block {
      width: 100%;
    }

    /* Technique List */
    .technique-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .technique-card {
      background: white;
      border-radius: 16px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: transform 0.2s;
      color: var(--gray-900);
    }

    .technique-card:hover {
      transform: scale(1.02);
    }

    .technique-rank {
      width: 36px;
      height: 36px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
    }

    .technique-info {
      flex: 1;
    }

    .technique-name {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .technique-meta {
      font-size: 12px;
      color: var(--gray-500);
    }

    /* Session Screen */
    .session-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 160px);
      text-align: center;
    }

    .timer {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .timer-label {
      opacity: 0.8;
      margin-bottom: 32px;
    }

    .breathing-circle-container {
      position: relative;
      width: 240px;
      height: 240px;
      margin-bottom: 32px;
    }

    .breathing-circle-bg {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 4px solid rgba(255,255,255,0.2);
    }

    .breathing-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 160px;
      height: 160px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s ease-out;
    }

    .breathing-circle.inhale {
      animation: inhale 4s ease-in-out forwards;
    }

    .breathing-circle.exhale {
      animation: exhale 4s ease-in-out forwards;
    }

    @keyframes inhale {
      from { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
      to { transform: translate(-50%, -50%) scale(1.4); opacity: 1; }
    }

    @keyframes exhale {
      from { transform: translate(-50%, -50%) scale(1.4); opacity: 1; }
      to { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
    }

    .phase-text {
      color: var(--primary);
      font-size: 18px;
      font-weight: 600;
    }

    .cycle-count {
      margin-bottom: 24px;
      opacity: 0.8;
    }

    .session-controls {
      display: flex;
      gap: 16px;
    }

    .control-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .control-btn.primary {
      width: 72px;
      height: 72px;
      background: white;
      color: var(--primary);
    }

    .control-btn.secondary {
      background: rgba(255,255,255,0.2);
      color: white;
    }

    .control-btn:hover {
      transform: scale(1.1);
    }

    /* Progress Screen */
    .progress-section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .weekly-chart {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      height: 120px;
      background: rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 16px;
    }

    .chart-bar-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }

    .chart-bar {
      width: 24px;
      background: white;
      border-radius: 4px;
      min-height: 4px;
      transition: height 0.3s;
    }

    .chart-label {
      font-size: 11px;
      margin-top: 8px;
      opacity: 0.7;
    }

    /* Setup Screen */
    .setup-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 160px);
      text-align: center;
    }

    .mood-selector {
      display: flex;
      gap: 12px;
      margin: 24px 0;
    }

    .mood-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mood-btn.selected {
      background: white;
      color: var(--primary);
      transform: scale(1.1);
    }

    /* Complete Screen */
    .complete-icon {
      width: 80px;
      height: 80px;
      background: var(--green);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
    }

    .star-rating {
      display: flex;
      gap: 8px;
      margin: 16px 0 24px;
    }

    .star-btn {
      background: none;
      border: none;
      font-size: 32px;
      cursor: pointer;
      color: rgba(255,255,255,0.3);
      transition: all 0.2s;
    }

    .star-btn.filled {
      color: #fbbf24;
    }

    /* Hidden */
    .hidden {
      display: none !important;
    }

    /* ==========================================
       HEALTH DISCLAIMER MODAL STYLES
       ========================================== */

    .disclaimer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .disclaimer-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .disclaimer-modal {
      background: white;
      border-radius: 24px;
      max-width: 600px;
      width: 100%;
      max-height: 85vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .disclaimer-overlay.active .disclaimer-modal {
      transform: scale(1);
    }

    .disclaimer-header {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      color: white;
      padding: 24px;
      text-align: center;
    }

    .disclaimer-header-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .disclaimer-header h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .disclaimer-header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .disclaimer-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      color: var(--gray-900);
    }

    .disclaimer-section {
      margin-bottom: 24px;
    }

    .disclaimer-section:last-child {
      margin-bottom: 0;
    }

    .disclaimer-section h2 {
      font-size: 16px;
      font-weight: 700;
      color: #dc2626;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .disclaimer-section h2 .section-icon {
      font-size: 20px;
    }

    .disclaimer-section p {
      font-size: 14px;
      line-height: 1.6;
      color: var(--gray-700);
      margin-bottom: 12px;
    }

    .disclaimer-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .disclaimer-section ul li {
      font-size: 14px;
      line-height: 1.5;
      color: var(--gray-700);
      padding: 8px 0 8px 28px;
      position: relative;
      border-bottom: 1px solid var(--gray-100);
    }

    .disclaimer-section ul li:last-child {
      border-bottom: none;
    }

    .disclaimer-section ul li::before {
      content: "‚ö†Ô∏è";
      position: absolute;
      left: 0;
      top: 8px;
    }

    .disclaimer-section.stop-symptoms ul li::before {
      content: "üö®";
    }

    .disclaimer-section.consult ul li::before {
      content: "üë®‚Äç‚öïÔ∏è";
    }

    .disclaimer-section.acknowledgments ul li::before {
      content: "‚úì";
      color: var(--primary);
      font-weight: bold;
    }

    .disclaimer-warning-box {
      background: #fef2f2;
      border: 2px solid #dc2626;
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
    }

    .disclaimer-warning-box p {
      color: #991b1b;
      font-weight: 600;
      margin: 0;
      font-size: 13px;
      line-height: 1.5;
    }

    .disclaimer-info-box {
      background: #eff6ff;
      border: 2px solid var(--primary);
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
    }

    .disclaimer-info-box p {
      color: #1e40af;
      font-weight: 500;
      margin: 0;
      font-size: 13px;
      line-height: 1.5;
    }

    .disclaimer-footer {
      padding: 20px 24px;
      background: var(--gray-50);
      border-top: 1px solid var(--gray-200);
    }

    .disclaimer-checkbox-group {
      margin-bottom: 16px;
    }

    .disclaimer-checkbox {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      background: white;
      border: 2px solid var(--gray-200);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 8px;
    }

    .disclaimer-checkbox:hover {
      border-color: var(--primary);
    }

    .disclaimer-checkbox.checked {
      border-color: var(--primary);
      background: #eff6ff;
    }

    .disclaimer-checkbox input {
      width: 20px;
      height: 20px;
      margin-top: 2px;
      cursor: pointer;
      accent-color: var(--primary);
    }

    .disclaimer-checkbox span {
      font-size: 13px;
      line-height: 1.5;
      color: var(--gray-700);
      flex: 1;
    }

    .disclaimer-checkbox span strong {
      color: var(--gray-900);
    }

    .disclaimer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 16px;
      font-size: 12px;
    }

    .disclaimer-links a {
      color: var(--primary);
      text-decoration: none;
    }

    .disclaimer-links a:hover {
      text-decoration: underline;
    }

    .disclaimer-accept-btn {
      width: 100%;
      padding: 16px 24px;
      font-size: 16px;
      font-weight: 700;
      color: white;
      background: var(--gray-300);
      border: none;
      border-radius: 12px;
      cursor: not-allowed;
      transition: all 0.3s ease;
    }

    .disclaimer-accept-btn.enabled {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      cursor: pointer;
    }

    .disclaimer-accept-btn.enabled:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    .disclaimer-version {
      text-align: center;
      font-size: 11px;
      color: var(--gray-400);
      margin-top: 12px;
    }

    /* Legal Document Modal */
    .legal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .legal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .legal-modal {
      background: white;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .legal-modal-header {
      padding: 20px 24px;
      background: var(--gray-50);
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .legal-modal-header h2 {
      font-size: 18px;
      color: var(--gray-900);
    }

    .legal-close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--gray-500);
      padding: 4px;
      line-height: 1;
    }

    .legal-close-btn:hover {
      color: var(--gray-900);
    }

    .legal-modal-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      font-size: 13px;
      line-height: 1.7;
      color: var(--gray-700);
    }

    .legal-modal-content h3 {
      font-size: 14px;
      color: var(--gray-900);
      margin: 20px 0 10px;
    }

    .legal-modal-content h3:first-child {
      margin-top: 0;
    }

    .legal-modal-content p {
      margin-bottom: 12px;
    }

    .legal-modal-content ul {
      margin: 12px 0;
      padding-left: 24px;
    }

    .legal-modal-content ul li {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <!-- ==========================================
       HEALTH DISCLAIMER MODAL
       First-launch comprehensive health warning
       ========================================== -->
  <div id="disclaimer-overlay" class="disclaimer-overlay">
    <div class="disclaimer-modal">
      <div class="disclaimer-header">
        <div class="disclaimer-header-icon">‚ö†Ô∏è</div>
        <h1>Important Health & Safety Disclaimer</h1>
        <p>Please read carefully before using the Breathe app</p>
      </div>

      <div class="disclaimer-content">
        <!-- Section 1: Not a Medical Device -->
        <div class="disclaimer-section">
          <h2><span class="section-icon">üè•</span> This App is NOT a Medical Device</h2>
          <p>The Breathe application has <strong>NOT</strong> been evaluated, cleared, or approved by the U.S. Food and Drug Administration (FDA), Health Canada, the European Medicines Agency (EMA), the Therapeutic Goods Administration (TGA), or any other regulatory body.</p>
          <div class="disclaimer-warning-box">
            <p>‚ö†Ô∏è THE BREATHE APP DOES NOT PROVIDE MEDICAL ADVICE, DIAGNOSIS, TREATMENT, OR CURE FOR ANY DISEASE, CONDITION, OR HEALTH PROBLEM. The breathing exercises are for general wellness purposes only.</p>
          </div>
        </div>

        <!-- Section 2: Not a Substitute -->
        <div class="disclaimer-section">
          <h2><span class="section-icon">üë®‚Äç‚öïÔ∏è</span> Not a Substitute for Professional Care</h2>
          <p>This app is <strong>NOT</strong> intended to replace:</p>
          <ul class="consult">
            <li>Professional medical advice from a licensed physician</li>
            <li>Mental health counseling from a licensed therapist</li>
            <li>Emergency medical treatment or intervention</li>
            <li>Prescribed medication or therapy programs</li>
            <li>Consultation with qualified healthcare providers</li>
          </ul>
          <div class="disclaimer-info-box">
            <p>‚ÑπÔ∏è ALWAYS consult your physician or qualified healthcare provider before beginning any breathing exercise program, especially if you have existing health conditions.</p>
          </div>
        </div>

        <!-- Section 3: STOP Immediately If... -->
        <div class="disclaimer-section stop-symptoms">
          <h2><span class="section-icon">üö®</span> STOP Immediately & Seek Medical Help If You Experience:</h2>
          <ul>
            <li><strong>Dizziness, lightheadedness, or fainting</strong> - Stop all breathing exercises immediately</li>
            <li><strong>Shortness of breath or difficulty breathing</strong> - This could indicate a serious condition</li>
            <li><strong>Chest pain, pressure, tightness, or discomfort</strong> - May indicate cardiac issues</li>
            <li><strong>Heart palpitations, rapid or irregular heartbeat</strong> - Could be a sign of arrhythmia</li>
            <li><strong>Numbness, tingling, or weakness</strong> - May indicate circulation or neurological issues</li>
            <li><strong>Nausea, vomiting, or severe headache</strong> - Could indicate various medical conditions</li>
            <li><strong>Visual disturbances or blurred vision</strong> - May indicate blood pressure changes</li>
            <li><strong>Anxiety, panic attacks, or severe emotional distress</strong> - Certain techniques may not be suitable</li>
            <li><strong>Confusion, disorientation, or altered consciousness</strong> - Seek immediate medical attention</li>
            <li><strong>Any other symptoms that concern you</strong> - Trust your instincts and stop immediately</li>
          </ul>
        </div>

        <!-- Section 4: Consult Before Use -->
        <div class="disclaimer-section consult">
          <h2><span class="section-icon">‚öïÔ∏è</span> Consult Your Doctor BEFORE Using If You Have:</h2>
          <ul>
            <li><strong>Cardiovascular conditions</strong> - Heart disease, heart failure, arrhythmias, angina</li>
            <li><strong>High or low blood pressure</strong> - Hypertension or hypotension</li>
            <li><strong>Respiratory conditions</strong> - Asthma, COPD, emphysema, bronchitis, sleep apnea</li>
            <li><strong>Neurological conditions</strong> - Epilepsy, seizure disorders, migraines</li>
            <li><strong>Mental health conditions</strong> - Anxiety disorders, panic disorder, PTSD, depression</li>
            <li><strong>Pregnancy or nursing</strong> - Some techniques may not be appropriate</li>
            <li><strong>Recent surgery or injury</strong> - Especially thoracic or abdominal</li>
            <li><strong>Diabetes</strong> - Blood sugar levels can be affected by breathing patterns</li>
            <li><strong>Glaucoma or retinal detachment</strong> - Certain techniques increase intraocular pressure</li>
            <li><strong>History of stroke or TIA</strong> - Blood pressure changes may pose risks</li>
            <li><strong>Taking medications</strong> - Especially cardiovascular, respiratory, or psychiatric medications</li>
            <li><strong>Any chronic health condition</strong> - Consult your healthcare provider first</li>
          </ul>
        </div>

        <!-- Section 5: Safe Use Guidelines -->
        <div class="disclaimer-section">
          <h2><span class="section-icon">üõ°Ô∏è</span> Safe Use Guidelines</h2>
          <ul>
            <li><strong>DO NOT</strong> use while driving, operating machinery, or in situations requiring full attention</li>
            <li><strong>DO NOT</strong> use while swimming, bathing, or near water</li>
            <li><strong>DO NOT</strong> use in environments where losing consciousness would be dangerous</li>
            <li><strong>Start slowly</strong> - Begin with shorter sessions and gentler techniques</li>
            <li><strong>Practice in a safe environment</strong> - Sit or lie down in a comfortable, safe location</li>
            <li><strong>Stay hydrated</strong> - Drink water before and after sessions</li>
            <li><strong>Listen to your body</strong> - Stop immediately if anything feels wrong</li>
            <li><strong>Do not force breathing</strong> - Breathing should never be painful or uncomfortable</li>
          </ul>
        </div>

        <!-- Section 6: Assumption of Risk -->
        <div class="disclaimer-section">
          <h2><span class="section-icon">üìã</span> Assumption of Risk & Release</h2>
          <div class="disclaimer-warning-box">
            <p>BY USING THIS APP, YOU ACKNOWLEDGE THAT BREATHING EXERCISES CARRY INHERENT RISKS AND YOU VOLUNTARILY ASSUME ALL SUCH RISKS. You understand that [COMPANY_NAME] is NOT responsible for any injury, illness, death, or other harm that may result from your use of this app.</p>
          </div>
          <p>You agree that you are solely responsible for your own health and safety while using this app. You release [COMPANY_NAME], its officers, directors, employees, and affiliates from any and all liability arising from your use of this app.</p>
        </div>

        <!-- Section 7: Emergency Information -->
        <div class="disclaimer-section">
          <h2><span class="section-icon">üÜò</span> In Case of Emergency</h2>
          <div class="disclaimer-warning-box">
            <p>THIS APP IS NOT FOR EMERGENCIES. If you are experiencing a medical emergency, IMMEDIATELY call your local emergency services:</p>
          </div>
          <ul>
            <li><strong>United States:</strong> 911</li>
            <li><strong>United Kingdom:</strong> 999</li>
            <li><strong>European Union:</strong> 112</li>
            <li><strong>Australia:</strong> 000</li>
            <li><strong>Canada:</strong> 911</li>
          </ul>
          <p style="margin-top: 12px; font-weight: 600;">Do NOT rely on this app for emergency medical assistance.</p>
        </div>

        <!-- Section 8: Limitation of Liability -->
        <div class="disclaimer-section">
          <h2><span class="section-icon">‚öñÔ∏è</span> Limitation of Liability</h2>
          <p>TO THE MAXIMUM EXTENT PERMITTED BY LAW, [COMPANY_NAME] SHALL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES, INCLUDING BUT NOT LIMITED TO:</p>
          <ul>
            <li>Personal injury, illness, or death</li>
            <li>Any health consequences from performing breathing exercises</li>
            <li>Loss of profits, data, or goodwill</li>
            <li>Any other damages arising from your use of this app</li>
          </ul>
          <p><strong>TOTAL LIABILITY IS LIMITED TO THE LESSER OF $100 OR THE AMOUNT PAID FOR THE APP IN THE PRECEDING 12 MONTHS.</strong></p>
        </div>

      </div>

      <div class="disclaimer-footer">
        <div class="disclaimer-checkbox-group">
          <label class="disclaimer-checkbox" id="checkbox1-label">
            <input type="checkbox" id="disclaimer-checkbox-1" onchange="updateDisclaimerCheckbox(1)">
            <span>I have <strong>read and understood</strong> the complete health and safety disclaimer above, including all warnings about when NOT to use this app and when to seek medical attention.</span>
          </label>
          <label class="disclaimer-checkbox" id="checkbox2-label">
            <input type="checkbox" id="disclaimer-checkbox-2" onchange="updateDisclaimerCheckbox(2)">
            <span>I understand that this app is <strong>NOT a medical device</strong>, does NOT provide medical advice, and is NOT a substitute for professional medical care. I will consult my healthcare provider before use if I have any health conditions.</span>
          </label>
          <label class="disclaimer-checkbox" id="checkbox3-label">
            <input type="checkbox" id="disclaimer-checkbox-3" onchange="updateDisclaimerCheckbox(3)">
            <span>I <strong>voluntarily assume all risks</strong> associated with using this app and performing breathing exercises. I agree to the <strong>Terms of Service</strong> and <strong>Privacy Policy</strong>, including the limitation of liability and arbitration provisions.</span>
          </label>
          <label class="disclaimer-checkbox" id="checkbox4-label">
            <input type="checkbox" id="disclaimer-checkbox-4" onchange="updateDisclaimerCheckbox(4)">
            <span>I am <strong>at least 13 years old</strong> (or have parental consent), and I am NOT currently experiencing any medical emergency or acute health crisis.</span>
          </label>
        </div>

        <div class="disclaimer-links">
          <a href="#" onclick="showLegalDocument('terms'); return false;">üìÑ Terms of Service</a>
          <a href="#" onclick="showLegalDocument('privacy'); return false;">üîí Privacy Policy</a>
        </div>

        <button id="disclaimer-accept-btn" class="disclaimer-accept-btn" onclick="acceptDisclaimer()" disabled>
          I Understand and Accept All Terms
        </button>

        <div class="disclaimer-version">
          Disclaimer Version 1.0 | Last Updated: [EFFECTIVE_DATE]
        </div>
      </div>
    </div>
  </div>

  <!-- Legal Document Modal (Terms of Service / Privacy Policy) -->
  <div id="legal-overlay" class="legal-overlay">
    <div class="legal-modal">
      <div class="legal-modal-header">
        <h2 id="legal-modal-title">Legal Document</h2>
        <button class="legal-close-btn" onclick="closeLegalDocument()">√ó</button>
      </div>
      <div class="legal-modal-content" id="legal-modal-content">
        <!-- Content loaded dynamically -->
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Home Screen -->
    <div id="home-screen" class="screen active">
      <h1 class="greeting">Good morning!</h1>
      <p class="subtitle">Ready to breathe?</p>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="streak-value">0</div>
          <div class="stat-label">Day streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="minutes-value">0</div>
          <div class="stat-label">Minutes</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="sessions-value">0</div>
          <div class="stat-label">Sessions</div>
        </div>
      </div>

      <div class="quick-start">
        <div class="quick-start-label">Recommended for you</div>
        <div class="quick-start-title">Cyclic Sighing</div>
        <div class="quick-start-desc">Stanford-proven technique for rapid stress relief</div>
        <button class="btn btn-primary" onclick="startSession('cyclic-sighing')">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          Start Session
        </button>
      </div>

      <h2 class="section-title">Top Techniques</h2>
      <div class="technique-list" id="technique-list"></div>
    </div>

    <!-- Techniques Screen -->
    <div id="techniques-screen" class="screen">
      <h1 class="greeting">Techniques</h1>
      <p class="subtitle">15 evidence-based breathing exercises</p>
      <div class="technique-list" id="all-techniques-list"></div>
    </div>

    <!-- Progress Screen -->
    <div id="progress-screen" class="screen">
      <h1 class="greeting">Your Progress</h1>
      <p class="subtitle">Track your breathing journey</p>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="progress-streak">0</div>
          <div class="stat-label">Day streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="progress-minutes">0</div>
          <div class="stat-label">Total min</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="progress-sessions">0</div>
          <div class="stat-label">Sessions</div>
        </div>
      </div>

      <div class="progress-section">
        <h2 class="section-title">This Week</h2>
        <div class="weekly-chart" id="weekly-chart"></div>
      </div>
    </div>

    <!-- Session Setup Screen -->
    <div id="setup-screen" class="screen">
      <div class="setup-screen">
        <h1 class="greeting">How are you feeling?</h1>
        <p class="subtitle">Rate your current state (1-5)</p>
        <div class="mood-selector">
          <button class="mood-btn" onclick="selectPreMood(1)">1</button>
          <button class="mood-btn" onclick="selectPreMood(2)">2</button>
          <button class="mood-btn" onclick="selectPreMood(3)">3</button>
          <button class="mood-btn" onclick="selectPreMood(4)">4</button>
          <button class="mood-btn" onclick="selectPreMood(5)">5</button>
        </div>
        <p id="session-technique-name" style="font-size: 20px; font-weight: 600; margin: 24px 0 8px;">Cyclic Sighing</p>
        <p style="opacity: 0.8; margin-bottom: 24px;">5 minutes</p>
        <button class="btn btn-primary btn-block" id="begin-btn" onclick="beginSession()" disabled>
          Begin Session
        </button>
        <button class="btn btn-secondary btn-block" style="margin-top: 12px;" onclick="cancelSession()">
          Cancel
        </button>
      </div>
    </div>

    <!-- Active Session Screen -->
    <div id="session-screen" class="screen">
      <div class="session-screen">
        <div class="timer" id="session-timer">0:00</div>
        <div class="timer-label">of <span id="session-duration">5:00</span></div>

        <div class="breathing-circle-container">
          <div class="breathing-circle-bg"></div>
          <div class="breathing-circle" id="breathing-circle">
            <span class="phase-text" id="phase-text">Ready</span>
          </div>
        </div>

        <div class="cycle-count">Cycle <span id="cycle-count">1</span></div>

        <div class="session-controls">
          <button class="control-btn secondary" onclick="resetSession()">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
          </button>
          <button class="control-btn primary" id="pause-btn" onclick="togglePause()">
            <svg id="pause-icon" width="32" height="32" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            <svg id="play-icon" class="hidden" width="32" height="32" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          </button>
          <button class="control-btn secondary" onclick="completeSession()">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Complete Screen -->
    <div id="complete-screen" class="screen">
      <div class="setup-screen">
        <div class="complete-icon">
          <svg width="40" height="40" fill="white" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
        </div>
        <h1 class="greeting">Great job!</h1>
        <p class="subtitle" id="complete-duration">You completed 5:00 of breathing</p>

        <p style="margin-top: 24px;">How do you feel now?</p>
        <div class="mood-selector">
          <button class="mood-btn" onclick="selectPostMood(1)">1</button>
          <button class="mood-btn" onclick="selectPostMood(2)">2</button>
          <button class="mood-btn" onclick="selectPostMood(3)">3</button>
          <button class="mood-btn" onclick="selectPostMood(4)">4</button>
          <button class="mood-btn" onclick="selectPostMood(5)">5</button>
        </div>

        <p>Rate this session</p>
        <div class="star-rating">
          <button class="star-btn" onclick="selectRating(1)">‚òÖ</button>
          <button class="star-btn" onclick="selectRating(2)">‚òÖ</button>
          <button class="star-btn" onclick="selectRating(3)">‚òÖ</button>
          <button class="star-btn" onclick="selectRating(4)">‚òÖ</button>
          <button class="star-btn" onclick="selectRating(5)">‚òÖ</button>
        </div>

        <button class="btn btn-primary btn-block" id="save-btn" onclick="saveSession()" disabled>
          Save & Continue
        </button>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="nav no-drag">
    <button class="nav-item active" onclick="showScreen('home')">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      Home
    </button>
    <button class="nav-item" onclick="showScreen('techniques')">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
      Techniques
    </button>
    <button class="nav-item" onclick="showScreen('progress')">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
      Progress
    </button>
  </nav>

  <script>
    // ==========================================
    // HEALTH DISCLAIMER FUNCTIONS
    // ==========================================

    const DISCLAIMER_VERSION = '1.0';
    const DISCLAIMER_STORAGE_KEY = 'breathe-disclaimer-accepted';

    // Check if disclaimer was accepted
    function checkDisclaimer() {
      let accepted = false;

      if (window.electronAPI) {
        // For Electron, we'll check synchronously via localStorage as fallback
        const stored = localStorage.getItem(DISCLAIMER_STORAGE_KEY);
        if (stored) {
          try {
            const data = JSON.parse(stored);
            accepted = data.version === DISCLAIMER_VERSION && data.accepted === true;
          } catch (e) {
            accepted = false;
          }
        }
      } else {
        const stored = localStorage.getItem(DISCLAIMER_STORAGE_KEY);
        if (stored) {
          try {
            const data = JSON.parse(stored);
            accepted = data.version === DISCLAIMER_VERSION && data.accepted === true;
          } catch (e) {
            accepted = false;
          }
        }
      }

      if (!accepted) {
        showDisclaimer();
      }
    }

    // Show the disclaimer modal
    function showDisclaimer() {
      const overlay = document.getElementById('disclaimer-overlay');
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Update checkbox states
    function updateDisclaimerCheckbox(num) {
      const checkbox = document.getElementById(`disclaimer-checkbox-${num}`);
      const label = document.getElementById(`checkbox${num}-label`);

      if (checkbox.checked) {
        label.classList.add('checked');
      } else {
        label.classList.remove('checked');
      }

      checkAllCheckboxes();
    }

    // Check if all checkboxes are checked
    function checkAllCheckboxes() {
      const checkbox1 = document.getElementById('disclaimer-checkbox-1').checked;
      const checkbox2 = document.getElementById('disclaimer-checkbox-2').checked;
      const checkbox3 = document.getElementById('disclaimer-checkbox-3').checked;
      const checkbox4 = document.getElementById('disclaimer-checkbox-4').checked;

      const acceptBtn = document.getElementById('disclaimer-accept-btn');

      if (checkbox1 && checkbox2 && checkbox3 && checkbox4) {
        acceptBtn.disabled = false;
        acceptBtn.classList.add('enabled');
      } else {
        acceptBtn.disabled = true;
        acceptBtn.classList.remove('enabled');
      }
    }

    // Accept the disclaimer
    function acceptDisclaimer() {
      const checkbox1 = document.getElementById('disclaimer-checkbox-1').checked;
      const checkbox2 = document.getElementById('disclaimer-checkbox-2').checked;
      const checkbox3 = document.getElementById('disclaimer-checkbox-3').checked;
      const checkbox4 = document.getElementById('disclaimer-checkbox-4').checked;

      if (!(checkbox1 && checkbox2 && checkbox3 && checkbox4)) {
        return;
      }

      // Save acceptance
      const acceptanceData = {
        version: DISCLAIMER_VERSION,
        accepted: true,
        acceptedAt: new Date().toISOString(),
        checkboxes: {
          readAndUnderstood: checkbox1,
          notMedicalDevice: checkbox2,
          assumesRisks: checkbox3,
          ageConfirmed: checkbox4
        }
      };

      localStorage.setItem(DISCLAIMER_STORAGE_KEY, JSON.stringify(acceptanceData));

      // Also save to electron store if available
      if (window.electronAPI && window.electronAPI.store) {
        window.electronAPI.store.set(DISCLAIMER_STORAGE_KEY, acceptanceData);
      }

      // Hide the disclaimer
      const overlay = document.getElementById('disclaimer-overlay');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    // Show legal document (Terms or Privacy)
    function showLegalDocument(type) {
      const overlay = document.getElementById('legal-overlay');
      const title = document.getElementById('legal-modal-title');
      const content = document.getElementById('legal-modal-content');

      if (type === 'terms') {
        title.textContent = 'Terms of Service';
        content.innerHTML = getTermsOfServiceSummary();
      } else if (type === 'privacy') {
        title.textContent = 'Privacy Policy';
        content.innerHTML = getPrivacyPolicySummary();
      }

      overlay.classList.add('active');
    }

    // Close legal document modal
    function closeLegalDocument() {
      const overlay = document.getElementById('legal-overlay');
      overlay.classList.remove('active');
    }

    // Terms of Service Summary (key points)
    function getTermsOfServiceSummary() {
      return `
        <h3>üìã TERMS OF SERVICE SUMMARY</h3>
        <p><strong>Last Updated:</strong> [EFFECTIVE_DATE]</p>
        <p>This is a summary of key terms. The full Terms of Service is available at [WEBSITE]/terms</p>

        <h3>1. Acceptance of Terms</h3>
        <p>By using the Breathe app, you agree to be bound by these Terms of Service. If you do not agree, do not use the app.</p>

        <h3>2. License Grant</h3>
        <p>We grant you a limited, non-exclusive, non-transferable, revocable license to use the app for personal, non-commercial purposes on up to 3 devices.</p>

        <h3>3. Health Disclaimer</h3>
        <p><strong>IMPORTANT:</strong> The Breathe app is NOT a medical device and does NOT provide medical advice, diagnosis, or treatment. Always consult your healthcare provider before use.</p>

        <h3>4. Prohibited Uses</h3>
        <p>You may not: reverse engineer the app, use it for commercial purposes without consent, distribute or resell the app, or use it illegally.</p>

        <h3>5. Intellectual Property</h3>
        <p>All content, features, and functionality of the app are owned by [COMPANY_NAME] and protected by intellectual property laws.</p>

        <h3>6. Disclaimer of Warranties</h3>
        <p>THE APP IS PROVIDED "AS IS" AND "AS AVAILABLE" WITHOUT WARRANTIES OF ANY KIND, EXPRESS OR IMPLIED.</p>

        <h3>7. Limitation of Liability</h3>
        <p>Our total liability is limited to the lesser of $100 or the amount you paid for the app in the preceding 12 months. We are not liable for any indirect, incidental, special, consequential, or punitive damages.</p>

        <h3>8. Indemnification</h3>
        <p>You agree to defend, indemnify, and hold harmless [COMPANY_NAME] from any claims arising from your use of the app or violation of these terms.</p>

        <h3>9. Dispute Resolution</h3>
        <p><strong>IMPORTANT:</strong> Disputes are resolved through binding arbitration, not in court. You waive your right to participate in class actions and jury trials.</p>

        <h3>10. Termination</h3>
        <p>We may terminate your license at any time for any reason. Upon termination, you must stop using and delete the app.</p>

        <h3>11. Governing Law</h3>
        <p>These terms are governed by the laws of [STATE], United States.</p>

        <h3>12. Contact</h3>
        <p>Questions? Contact us at [EMAIL]</p>

        <p style="margin-top: 24px; padding: 12px; background: #f3f4f6; border-radius: 8px; font-size: 12px;">
          <strong>Full Terms of Service:</strong> The complete legal document is available at [WEBSITE]/terms. This summary is provided for convenience only and does not replace the full Terms of Service.
        </p>
      `;
    }

    // Privacy Policy Summary (key points)
    function getPrivacyPolicySummary() {
      return `
        <h3>üîí PRIVACY POLICY SUMMARY</h3>
        <p><strong>Last Updated:</strong> [EFFECTIVE_DATE]</p>
        <p>This is a summary of our privacy practices. The full Privacy Policy is available at [WEBSITE]/privacy</p>

        <h3>1. Data We Collect</h3>
        <p><strong>LOCAL DATA ONLY:</strong> The Breathe app stores all your data locally on your device. We do NOT transmit your breathing sessions, mood ratings, or statistics to our servers.</p>
        <ul>
          <li>‚úÖ Breathing session data (stored locally)</li>
          <li>‚úÖ Mood ratings (stored locally)</li>
          <li>‚úÖ App preferences (stored locally)</li>
          <li>‚ùå We do NOT collect personal identification info</li>
          <li>‚ùå We do NOT track your location</li>
          <li>‚ùå We do NOT use advertising trackers</li>
        </ul>

        <h3>2. How We Use Your Data</h3>
        <p>Your locally stored data is used solely to:</p>
        <ul>
          <li>Track your breathing session progress</li>
          <li>Display your statistics and achievements</li>
          <li>Remember your preferences</li>
        </ul>

        <h3>3. Data Sharing</h3>
        <p><strong>WE DO NOT SELL YOUR DATA.</strong> Since your data stays on your device, we have no data to share with third parties.</p>

        <h3>4. Cookies & Tracking</h3>
        <p>The Breathe app does NOT use cookies, web beacons, tracking pixels, or advertising identifiers.</p>

        <h3>5. Your Rights</h3>
        <p>Depending on your location, you may have rights to:</p>
        <ul>
          <li>Access your data (view it in the app)</li>
          <li>Delete your data (uninstall the app or clear data)</li>
          <li>Data portability</li>
          <li>Object to processing</li>
        </ul>

        <h3>6. Children's Privacy (COPPA)</h3>
        <p>The app is intended for users 13 years and older. We do not knowingly collect data from children under 13.</p>

        <h3>7. GDPR Rights (EEA Residents)</h3>
        <p>EEA residents have rights under GDPR including access, rectification, erasure, restriction, portability, and objection.</p>

        <h3>8. CCPA Rights (California Residents)</h3>
        <p>California residents have rights under CCPA including the right to know, delete, opt-out of sale (we don't sell), and non-discrimination.</p>

        <h3>9. Data Security</h3>
        <p>Your data is stored locally on your device. We recommend keeping your device secure and updated.</p>

        <h3>10. Data Retention</h3>
        <p>Local data remains on your device until you delete the app or clear app data. You control your data.</p>

        <h3>11. Contact Us</h3>
        <p>Privacy questions? Contact us at [PRIVACY_EMAIL]</p>

        <p style="margin-top: 24px; padding: 12px; background: #f3f4f6; border-radius: 8px; font-size: 12px;">
          <strong>Full Privacy Policy:</strong> The complete legal document is available at [WEBSITE]/privacy. This summary is provided for convenience only and does not replace the full Privacy Policy.
        </p>
      `;
    }

    // Run disclaimer check when page loads
    document.addEventListener('DOMContentLoaded', function() {
      checkDisclaimer();
    });

    // ==========================================
    // END HEALTH DISCLAIMER FUNCTIONS
    // ==========================================

    // Breathing techniques data
    const techniques = [
      { id: 'cyclic-sighing', name: 'Cyclic Sighing', rank: 1, difficulty: 'Beginner', duration: 300, inhale: 4, hold: 0, exhale: 6, holdEmpty: 0 },
      { id: 'coherent-breathing', name: 'Coherent Breathing', rank: 2, difficulty: 'Beginner', duration: 300, inhale: 5, hold: 0, exhale: 5, holdEmpty: 0 },
      { id: 'box-breathing', name: 'Box Breathing', rank: 3, difficulty: 'Beginner', duration: 300, inhale: 4, hold: 4, exhale: 4, holdEmpty: 4 },
      { id: 'diaphragmatic', name: 'Diaphragmatic Breathing', rank: 4, difficulty: 'Beginner', duration: 300, inhale: 4, hold: 0, exhale: 6, holdEmpty: 0 },
      { id: 'extended-exhale', name: 'Extended Exhale', rank: 5, difficulty: 'Beginner', duration: 300, inhale: 4, hold: 0, exhale: 8, holdEmpty: 0 },
      { id: '4-7-8-breathing', name: '4-7-8 Breathing', rank: 6, difficulty: 'Intermediate', duration: 300, inhale: 4, hold: 7, exhale: 8, holdEmpty: 0 },
      { id: 'wim-hof', name: 'Wim Hof Method', rank: 7, difficulty: 'Advanced', duration: 600, inhale: 2, hold: 0, exhale: 2, holdEmpty: 15 },
      { id: 'alternate-nostril', name: 'Alternate Nostril', rank: 8, difficulty: 'Intermediate', duration: 300, inhale: 4, hold: 4, exhale: 4, holdEmpty: 0 },
      { id: 'breath-of-fire', name: 'Breath of Fire', rank: 9, difficulty: 'Advanced', duration: 180, inhale: 0.5, hold: 0, exhale: 0.5, holdEmpty: 0 },
      { id: 'buteyko', name: 'Buteyko Method', rank: 10, difficulty: 'Intermediate', duration: 300, inhale: 3, hold: 3, exhale: 3, holdEmpty: 3 },
      { id: 'pursed-lip', name: 'Pursed Lip Breathing', rank: 11, difficulty: 'Beginner', duration: 300, inhale: 2, hold: 0, exhale: 4, holdEmpty: 0 },
      { id: 'resonant-breathing', name: 'Resonant Breathing', rank: 12, difficulty: 'Beginner', duration: 300, inhale: 6, hold: 0, exhale: 6, holdEmpty: 0 },
      { id: 'lion-breath', name: "Lion's Breath", rank: 13, difficulty: 'Beginner', duration: 180, inhale: 4, hold: 0, exhale: 4, holdEmpty: 2 },
      { id: 'ocean-breath', name: 'Ocean Breath (Ujjayi)', rank: 14, difficulty: 'Intermediate', duration: 300, inhale: 4, hold: 0, exhale: 6, holdEmpty: 0 },
      { id: 'humming-bee', name: 'Humming Bee Breath', rank: 15, difficulty: 'Beginner', duration: 300, inhale: 4, hold: 0, exhale: 8, holdEmpty: 0 },
    ];

    // App state
    let state = {
      sessions: [],
      currentScreen: 'home',
      currentTechnique: null,
      preMood: null,
      postMood: null,
      rating: null,
      sessionActive: false,
      sessionPaused: false,
      elapsedTime: 0,
      cycleCount: 1,
      currentPhase: 'inhale'
    };

    let sessionInterval = null;
    let phaseTimeout = null;

    // Initialize
    async function init() {
      // Load saved data
      if (window.electronAPI) {
        const savedSessions = await window.electronAPI.store.get('sessions');
        if (savedSessions) state.sessions = savedSessions;
      } else {
        const saved = localStorage.getItem('breathe-sessions');
        if (saved) state.sessions = JSON.parse(saved);
      }

      updateGreeting();
      updateStats();
      renderTechniqueList();
      renderAllTechniques();
      renderWeeklyChart();
    }

    function updateGreeting() {
      const hour = new Date().getHours();
      let greeting = 'Good evening';
      if (hour < 12) greeting = 'Good morning';
      else if (hour < 18) greeting = 'Good afternoon';
      document.querySelector('.greeting').textContent = greeting + '!';
    }

    function updateStats() {
      const totalSessions = state.sessions.length;
      const totalMinutes = Math.floor(state.sessions.reduce((sum, s) => sum + s.duration, 0) / 60);
      const streak = calculateStreak();

      document.getElementById('streak-value').textContent = streak;
      document.getElementById('minutes-value').textContent = totalMinutes;
      document.getElementById('sessions-value').textContent = totalSessions;

      document.getElementById('progress-streak').textContent = streak;
      document.getElementById('progress-minutes').textContent = totalMinutes;
      document.getElementById('progress-sessions').textContent = totalSessions;
    }

    function calculateStreak() {
      if (state.sessions.length === 0) return 0;

      const dates = [...new Set(state.sessions.map(s => s.date.split('T')[0]))].sort().reverse();
      const today = new Date().toISOString().split('T')[0];
      const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

      if (dates[0] !== today && dates[0] !== yesterday) return 0;

      let streak = 1;
      for (let i = 0; i < dates.length - 1; i++) {
        const diff = (new Date(dates[i]) - new Date(dates[i + 1])) / 86400000;
        if (diff === 1) streak++;
        else break;
      }
      return streak;
    }

    function renderTechniqueList() {
      const list = document.getElementById('technique-list');
      list.innerHTML = techniques.slice(0, 4).map(t => `
        <div class="technique-card no-drag" onclick="startSession('${t.id}')">
          <div class="technique-rank">${t.rank}</div>
          <div class="technique-info">
            <div class="technique-name">${t.name}</div>
            <div class="technique-meta">${t.difficulty} ¬∑ ${Math.floor(t.duration / 60)} min</div>
          </div>
          <svg width="20" height="20" fill="#9ca3af" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </div>
      `).join('');
    }

    function renderAllTechniques() {
      const list = document.getElementById('all-techniques-list');
      list.innerHTML = techniques.map(t => `
        <div class="technique-card no-drag" onclick="startSession('${t.id}')">
          <div class="technique-rank">${t.rank}</div>
          <div class="technique-info">
            <div class="technique-name">${t.name}</div>
            <div class="technique-meta">${t.difficulty} ¬∑ ${Math.floor(t.duration / 60)} min</div>
          </div>
          <svg width="20" height="20" fill="#9ca3af" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </div>
      `).join('');
    }

    function renderWeeklyChart() {
      const chart = document.getElementById('weekly-chart');
      const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      const weekData = [0, 0, 0, 0, 0, 0, 0];

      state.sessions.forEach(s => {
        const date = new Date(s.date);
        const dayDiff = Math.floor((Date.now() - date.getTime()) / 86400000);
        if (dayDiff >= 0 && dayDiff < 7) {
          weekData[6 - dayDiff] += Math.floor(s.duration / 60);
        }
      });

      const max = Math.max(...weekData, 1);
      chart.innerHTML = weekData.map((mins, i) => `
        <div class="chart-bar-container">
          <div class="chart-bar" style="height: ${(mins / max) * 80}px"></div>
          <div class="chart-label">${days[i]}</div>
        </div>
      `).join('');
    }

    function showScreen(screen) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

      document.getElementById(screen + '-screen').classList.add('active');
      document.querySelectorAll('.nav-item')[['home', 'techniques', 'progress'].indexOf(screen)]?.classList.add('active');

      state.currentScreen = screen;
    }

    function startSession(techniqueId) {
      state.currentTechnique = techniques.find(t => t.id === techniqueId);
      state.preMood = null;
      state.postMood = null;
      state.rating = null;

      document.getElementById('session-technique-name').textContent = state.currentTechnique.name;
      document.getElementById('begin-btn').disabled = true;
      document.querySelectorAll('#setup-screen .mood-btn').forEach(b => b.classList.remove('selected'));

      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById('setup-screen').classList.add('active');
      document.querySelector('.nav').style.display = 'none';
    }

    function selectPreMood(mood) {
      state.preMood = mood;
      document.querySelectorAll('#setup-screen .mood-btn').forEach((b, i) => {
        b.classList.toggle('selected', i + 1 === mood);
      });
      document.getElementById('begin-btn').disabled = false;
    }

    function cancelSession() {
      document.querySelector('.nav').style.display = 'flex';
      showScreen('home');
    }

    function beginSession() {
      state.elapsedTime = 0;
      state.cycleCount = 1;
      state.sessionActive = true;
      state.sessionPaused = false;
      state.currentPhase = 'inhale';

      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById('session-screen').classList.add('active');

      document.getElementById('session-duration').textContent = formatTime(state.currentTechnique.duration);
      updateSessionDisplay();
      startBreathingCycle();

      sessionInterval = setInterval(() => {
        if (!state.sessionPaused) {
          state.elapsedTime++;
          updateSessionDisplay();

          if (state.elapsedTime >= state.currentTechnique.duration) {
            completeSession();
          }
        }
      }, 1000);
    }

    function updateSessionDisplay() {
      document.getElementById('session-timer').textContent = formatTime(state.elapsedTime);
      document.getElementById('cycle-count').textContent = state.cycleCount;
    }

    function startBreathingCycle() {
      if (!state.sessionActive || state.sessionPaused) return;

      const t = state.currentTechnique;
      const phases = [];

      if (t.inhale > 0) phases.push({ name: 'Breathe In', duration: t.inhale * 1000, class: 'inhale' });
      if (t.hold > 0) phases.push({ name: 'Hold', duration: t.hold * 1000, class: '' });
      if (t.exhale > 0) phases.push({ name: 'Breathe Out', duration: t.exhale * 1000, class: 'exhale' });
      if (t.holdEmpty > 0) phases.push({ name: 'Hold', duration: t.holdEmpty * 1000, class: '' });

      let phaseIndex = 0;

      function runPhase() {
        if (!state.sessionActive || state.sessionPaused) return;

        const phase = phases[phaseIndex];
        const circle = document.getElementById('breathing-circle');
        const text = document.getElementById('phase-text');

        circle.className = 'breathing-circle ' + phase.class;
        text.textContent = phase.name;

        phaseTimeout = setTimeout(() => {
          phaseIndex++;
          if (phaseIndex >= phases.length) {
            phaseIndex = 0;
            state.cycleCount++;
            document.getElementById('cycle-count').textContent = state.cycleCount;
          }
          runPhase();
        }, phase.duration);
      }

      runPhase();
    }

    function togglePause() {
      state.sessionPaused = !state.sessionPaused;
      document.getElementById('pause-icon').classList.toggle('hidden', state.sessionPaused);
      document.getElementById('play-icon').classList.toggle('hidden', !state.sessionPaused);

      if (!state.sessionPaused) {
        startBreathingCycle();
      }
    }

    function resetSession() {
      clearInterval(sessionInterval);
      clearTimeout(phaseTimeout);
      state.elapsedTime = 0;
      state.cycleCount = 1;
      state.sessionPaused = false;
      document.getElementById('pause-icon').classList.remove('hidden');
      document.getElementById('play-icon').classList.add('hidden');
      updateSessionDisplay();
      startBreathingCycle();

      sessionInterval = setInterval(() => {
        if (!state.sessionPaused) {
          state.elapsedTime++;
          updateSessionDisplay();
          if (state.elapsedTime >= state.currentTechnique.duration) {
            completeSession();
          }
        }
      }, 1000);
    }

    function completeSession() {
      clearInterval(sessionInterval);
      clearTimeout(phaseTimeout);
      state.sessionActive = false;

      document.getElementById('complete-duration').textContent = `You completed ${formatTime(state.elapsedTime)} of breathing`;

      document.querySelectorAll('#complete-screen .mood-btn').forEach(b => b.classList.remove('selected'));
      document.querySelectorAll('.star-btn').forEach(b => b.classList.remove('filled'));
      document.getElementById('save-btn').disabled = true;

      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById('complete-screen').classList.add('active');
    }

    function selectPostMood(mood) {
      state.postMood = mood;
      document.querySelectorAll('#complete-screen .mood-btn').forEach((b, i) => {
        b.classList.toggle('selected', i + 1 === mood);
      });
      checkSaveButton();
    }

    function selectRating(rating) {
      state.rating = rating;
      document.querySelectorAll('.star-btn').forEach((b, i) => {
        b.classList.toggle('filled', i < rating);
      });
      checkSaveButton();
    }

    function checkSaveButton() {
      document.getElementById('save-btn').disabled = !(state.postMood && state.rating);
    }

    async function saveSession() {
      const session = {
        id: Date.now().toString(),
        techniqueId: state.currentTechnique.id,
        date: new Date().toISOString(),
        duration: state.elapsedTime,
        preMood: state.preMood,
        postMood: state.postMood,
        rating: state.rating
      };

      state.sessions.push(session);

      // Save to storage
      if (window.electronAPI) {
        await window.electronAPI.store.set('sessions', state.sessions);
      } else {
        localStorage.setItem('breathe-sessions', JSON.stringify(state.sessions));
      }

      updateStats();
      renderWeeklyChart();

      document.querySelector('.nav').style.display = 'flex';
      showScreen('home');
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // Initialize app
    init();
  </script>
</body>
</html>
